((N,T,I)=>{var B={},R={},S={},z=0,t="";function i(e){this.todo=[],this.updating=!1,this.isRendering=!1,this.instance={},this.init(e)}function H(){var e=this;if(N(I.body).hasClass("mmd-options-ready"))return!1;N(I.body).addClass("mmd-options-ready");var a=0,t=N(".mmd-easymde-prefs");e.userOptions=e.getUserOptions(t),e.stickyInst=[],t.on("click",function(){a&&clearTimeout(a),a=setTimeout(function(){e.saveUserOptions(t),e.setStickyToolbar()},100)}),e.setStickyToolbar()}i.prototype.mediaUploader=function(){var e,a=this;if(t.length||(t=(t=T.wp&&T.wp.pluginMarkupMarkdown&&T.wp.pluginMarkupMarkdown.homeURL?T.wp.pluginMarkupMarkdown.homeURL:(e=decodeURIComponent(jQuery('script[src*="wordpress_richedit-easymde"]').attr("src")),/home_url/.test(e)?e.replace(/.*?home_url=/,"").replace(/&.*?$/,""):"/")).replace(/^(.*?)(\.[a-z]+\/).*?$/,"$1$2"),a.home_url=t),!a.home_url&&t&&(a.home_url=t),B&&B.title)return!1;R=new MmdPreview({base_url:a.home_url,callbacks:{widget:function(){},multisel:function(){}}}),B=new MmdMedia({base_url:a.home_url,callbacks:{widget:function(e){e&&e.length&&a.mediaWidgetCallBack(e)},multisel:function(e){e&&e.length&&a.mediaMultiselCallBack(e)}}})},i.prototype.core=function(e){var a=N(e||"#none");if(!a.length)return!1;!a.attr("id")&&a.attr("name")&&a.attr("id",a.attr("name").replace(/[^a-zA-Z0-9]/g,""));function t(e,i){if(++l<=1)return!0;2===l&&o.push("|"),o.push({name:"mmd_wpsi18n_"+i.code,action:function(e){var a=r.instance.editor.codemirror.getDoc(),t=a.getSelection()||!1;if(t&&t.length)return r.instance.i18nAdded=1,a.replaceSelection('<span lang="'+i.code+'">'+t+"</span>")},className:"i18n "+i.code,text:i.code.toUpperCase(),title:i.label})}var r=this,i=N("body").hasClass("wp-admin")?1:0,n=0,o=((a.parent().hasClass("acf-input")||a.parents("form-field"))&&(n=1),r.mediaUploader(),[]),s={mmd_bold:{action:EasyMDE.toggleBold,className:"fa fa-bold"},mmd_italic:{action:EasyMDE.toggleItalic,className:"fa fa-italic"},mmd_strikethrough:{action:EasyMDE.toggleStrikethrough,className:"fa fa-strikethrough"},mmd_heading:{action:EasyMDE.toggleHeadingSmaller,className:"fa fa-header fa-heading"},"mmd_heading-smaller":{action:EasyMDE.toggleHeadingSmaller,className:"fa fa-header fa-heading"},"mmd_heading-bigger":{action:EasyMDE.toggleHeadingBigger,className:"fa fa-lg fa-header fa-heading"},"mmd_heading-1":{action:EasyMDE.toggleHeading1,className:"fa fa-header fa-heading header-1"},"mmd_heading-2":{action:EasyMDE.toggleHeading2,className:"fa fa-header fa-heading header-2"},"mmd_heading-3":{action:EasyMDE.toggleHeading3,className:"fa fa-header fa-heading header-3"},mmd_code:{action:EasyMDE.toggleCodeBlock,className:"fa fa-code"},mmd_quote:{action:EasyMDE.toggleBlockquote,className:"fa fa-quote-left"},"mmd_unordered-list":{action:EasyMDE.toggleUnorderedList,className:"fa fa-list-ul"},"mmd_ordered-list":{action:EasyMDE.toggleOrderedList,className:"fa fa-list-ol"},"mmd_clean-block":{action:EasyMDE.cleanBlock,className:"fa fa-eraser"},mmd_link:{action:EasyMDE.drawLink,className:"fa fa-link"},mmd_image:{action:EasyMDE.drawImage,className:"fa fa-picture-o"},"mmd_upload-image":{action:EasyMDE.drawUploadedImage,className:"fa fa-image"},mmd_table:{action:EasyMDE.drawTable,className:"fa fa-table"},"mmd_horizontal-rule":{action:EasyMDE.drawHorizontalRule,className:"fa fa-minus"},mmd_preview:{action:EasyMDE.togglePreview,className:"fa fa-eye no-disable"},"mmd_side-by-side":{action:EasyMDE.toggleSideBySide,className:"fa fa-columns no-disable no-mobile"},mmd_fullscreen:{action:EasyMDE.toggleFullScreen,className:"fa fa-arrows-alt no-disable no-mobile"},mmd_undo:{action:EasyMDE.undo,className:"fa fa-undo"},mmd_redo:{action:EasyMDE.redo,className:"fa fa-redo"}},d=(EasyMDE.wpsImage=function(e){(S=r).widgetCounter||(S.widgetCounter=1),B&&B.title||B.initialize(),B.open()},{disabled:1}),l=(T.wp&&T.wp.pluginMarkupMarkdown&&T.wp.pluginMarkupMarkdown.spellChecker&&"object"!=typeof(d=T.wp.pluginMarkupMarkdown.spellChecker)&&(d={disabled:1}),0),c="ltr";/mmd_dir\=(ltr|rtl)/.test(window.location.search||"")?c=window.location.search.match(/mmd_dir\=(ltr|rtl)/)[1]:(1<(window.isRTL||0)||"rtl"===(document.documentElement.dir||""))&&(c="rtl"),EasyMDE.switchHTMLDir=function(){var e=c&&"ltr"===c?"rtl":"ltr";document.location.href=[document.location.href.replace(/mmd_dir=[a-z]+/,""),"&mmd_dir="+e].join("")},s.mmd_rtltextdir={action:EasyMDE.switchHTMLDir,className:"fa"+("rtl"===c?"s":"r")+" fa-caret-square-left"},s.mmd_ltrtextdir={action:EasyMDE.switchHTMLDir,className:"fa"+("ltr"===c?"s":"r")+" fa-caret-square-right"};for(var m=0,u="",p="",g=r.toolbarButtons;m<g.length;m++)u=g[m],/pipe/.test(u)?o.push("|"):/spell[-_]*check/.test(u)?d.disabled||N.each(d,t):/wps[-_]*image/.test(u)?o.push({name:"wpsimage",action:EasyMDE.wpsImage,className:"fa fa-images",title:mmd_wpr_vars&&mmd_wpr_vars.wpsimage?mmd_wpr_vars.wpsimage:"Image"}):s[p=u.replace("_","-").replace("mmd-","mmd_")]?(s[p].name=p,mmd_wpr_vars&&mmd_wpr_vars[p]&&(s[p].title=mmd_wpr_vars[p]),o.push(s[p])):o.push(p.replace("mmd_",""));if(l<1&&(d={disabled:1}),n||!i){var f=[];if(/desc/.test(a.attr("name")||""))for(var h=0;h<o.length;h++)/\||bold|italic|pipe|list|link|image|preview|guide/.test(o[h].name||o[h]||"")&&f.push(o[h]);else for(var y=0;y<o.length;y++)/fullscreen|side/.test(o[y]||"")||f.push(o[y]);o=f}var k,w,_,M,b,i={autoDownloadFontAwesome:!1,element:a.get(0),toolbar:o,renderingConfig:{codeSyntaxHighlighting:!0},previewRender:function(e,a){return R.flushQueue(),e=r.previewRender(e,a),setTimeout(function(){R.runQueue(),N(T).trigger("resize.mmd_win_sticky_toolbar")},10),e},direction:c},v=(d&&"none"!==d&&!d.disabled?i.spellChecker=function(e){e.language=d,CodeMirrorSpellChecker(e)}:i.spellChecker=!1,r.instance.editor=new EasyMDE(i),r.instance.editor.codemirror.on("change",function(){a.val(r.instance.editor.value())}),T.wp.pluginMarkupMarkdown||(T.wp.pluginMarkupMarkdown={}),T.wp.pluginMarkupMarkdown.instances||(T.wp.pluginMarkupMarkdown.instances=[]),r.fieldNumber=z++,N(e).val().match(/\"myset.*?\s/g));if(v&&v.length){for(var E,C=0,D=0;D<v.length;D++)C<(E=parseInt(v[D].replace(/\d_/,"").replace(/[^\d]+/,""),10))&&(C=E);r.widgetCounter=C+1}T.wp.pluginMarkupMarkdown.instances.push(r.instance.editor),!d||d.disabled&&1===d.disabled||"none"===d?(document.dispatchEvent(new Event("CodeMirrorSpellCheckerReady")),0<n?a.closest(".acf-input, .form-field").addClass("ready"):(N("#wp-content-editor-container").addClass("ready"),new H,N(I.body).addClass("markupmarkdown-ready"))):(k={el:null,display:!1,active:!1,from:{},to:{},origin:""},w="",_=function(e){if(!k.el)return!1;k.el.style.display="none",k.el.innerHTML=""},M=function(e){if(!k.el)return!1;k.el.style.top=Math.ceil(e.clientY||0)+16+"px",k.el.style.left=Math.ceil(e.clientX||0)-16+"px",k.el.style.display="block"},b=function(){k.el=document.createElement("div"),k.el.id="mmd-suggestions",k.el.className="mmd-spellcheck-suggestions",document.body.appendChild(k.el),document.getElementById("mmd-suggestions").addEventListener("click",function(e){return event.preventDefault(),r.instance.editor.codemirror.replaceRange(e.target.firstChild.nodeValue,k.from,k.to,k.origin),setTimeout(function(){_(e)},450),!1},!1)},r.instance.editor.codemirror.on("mousedown",function(e,a){a&&a.target&&/cm-spell-error/.test(a.target.className||"")?(k.display||(b(),k.display=!0),M(a),w=(a.target.className||"").match(/.*?cm-(\w+)$/)[1],k.active=!0):k.active&&(k.active=!1,_(a))}),r.instance.editor.codemirror.on("cursorActivity",function(e){if(!k.active)return!1;var a=e.getCursor(),a=e.findWordAt(a);if(a&&a.anchor&&a.head&&CodeMirrorSpellChecker.typo[w]){for(var e=e.getRange(a.anchor,a.head),t=CodeMirrorSpellChecker.typo[w].suggest(e),i=["<ol>"],r=0;r<t.length;r++)/\d+/.test(t[r])||i.push('<li><a href="#mmd-suggestions">'+t[r]+"</li>");i.push("</ol>"),k.el=document.getElementById("mmd-suggestions"),k.el.innerHTML=i.join(""),k.from=a.anchor,k.to=a.head,k.origin=e}return k.active=!0})),0<n&&setTimeout(function(){r.instance.editor.codemirror.refresh()},250)},i.prototype.mediaWidgetCallBack=function(e){S.widgetCounter++;var a=S.instance.editor.codemirror.getDoc(),t=a.getCursor();return a.replaceRange(e,t)},i.prototype.mediaMultiselCallBack=function(e){var a=S.instance.editor.codemirror.getDoc(),t=a.getCursor();return a.replaceRange(e.replace(/myset\%d/g,"myset"+S.fieldNumber+"_"+S.widgetCounter),t)},i.prototype.previewRender=function(e,a){function t(e,a){return("tmp_node"+999999999*Math.random()).replace(/\.|\,/,"")}var i=this,r=(e=(e=i.instance.editor.markdown(e)).replace(/<h\d[^\>]*>.*?\{[^\}]+\}<\/h\d>/g,function(e){return R.processTask("convertHeading",e)}),0),n=(e=(e=(e=(e=(e=e.replace(/\[gallery([^\]]*)\]/g,function(e){return r++,'<div id="'+t()+'" class="tmp_media" data-pointer="tmp_gallery-'+r+'">'+R.add2Queue("gallery",e,r)+"</div>"})).replace(/\[playlist([^\]]*)\]/g,function(e){return r++,/type\=\"video\"/.test(e)?'<div id="'+t()+'" class="tmp_media" data-pointer="tmp_video_playlist-'+r+'">'+R.add2Queue("videoPlaylist",e,r)+"</div>":'<div id="'+t()+'" class="tmp_media" data-pointer="tmp_audio_playlist-'+r+'">'+R.add2Queue("audioPlaylist",e,r)+"</div>"})).replace(/<a.*?><img.*?>\{[^\}]+\}<\/a>/g,function(e){return R.processTask("convertImage",e,!1)})).replace(/<img.*?>\{[^\}]+\}/g,function(e){return R.processTask("convertImage",e,!1)})).replace(/<p><figure/,"<figure").replace(/<\/figure><\/p>/,"</figure>"),0),o=(e=e.replace(/\[audio([^\]]*)\]\[\/audio\]/g,function(e){return R.processTask("convertAudio",e,n++)}),0);return e=e.replace(/\[video([^\]]*)\]\[\/video\]/g,function(e){return R.processTask("convertVideo",e,o++)}),i.isRendering||(i.isRendering=setTimeout(function(){N(window).trigger("resize.mmd_preview"),i.isRendering=0},450)),e},i.prototype.init=function(e){var a=this;a.toolbarButtons&&a.toolbarButtons.length||!T.wp||!T.wp.pluginMarkupMarkdown||!T.wp.pluginMarkupMarkdown.toolbarButtons?a.toolbarButtons=["bold","italic","heading","spell-checker","pipe","quote","unordered-list","ordered-list","pipe","link","wpsimage","table","pipe","fullscreen","side-by-side","preview","guide"]:a.toolbarButtons=T.wp.pluginMarkupMarkdown.toolbarButtons,a.core(e)},N(I).ready(function(){N(I.body).addClass("easymde");function e(e){(e=e||!1)&&N(e).each(function(){new i(this)})}var a=1;if(!(a=!wp.pluginMarkupMarkdown||void 0===wp.pluginMarkupMarkdown.primaryArea||wp.pluginMarkupMarkdown.primaryArea&&!isNaN(parseInt(wp.pluginMarkupMarkdown.primaryArea,10))?a:0))return I.addEventListener("CodeMirrorSpellCheckerReady",function(){new H,N(I.body).addClass("markupmarkdown-ready").trigger("click.mmd_body_sticky_toolbar")}),e('textarea[name="description"]'),!0;I.addEventListener("CodeMirrorSpellCheckerReady",function(){t&&!t.hasClass("ready")&&(t.addClass("ready"),new H),N(I.body).addClass("markupmarkdown-ready").trigger("click.mmd_body_sticky_toolbar")});var t=N("#wp-content-editor-container").addClass("markupmarkdown");return t.length?(e(t.find(".wp-editor-area")),!0):(t=N(".acf-input #acf-_post_content").parent().addClass("markupmarkdown")).length?(e("#acf-_post_content"),!0):void e('textarea[name="description"]')}),T.MarkupMarkdown=i,H.prototype.getUserOptions=function(e){var a={};return e.find('input[type="checkbox"]').each(function(){a[this.id||"none"]=this.checked?this.value:0}),a},H.prototype.saveUserOptions=function(e){this.userOptions=this.getUserOptions(e),N.post(T.ajaxurl,{action:"mmduser-editoptions",options:this.userOptions,mmdeditoptionsnonce:N("#mmdeditoptionsnonce").val()})},H.prototype.setStickyToolbar=function(){var e,a,t,i=this,r=parseInt(i.userOptions.mmd_sticky_toolbar||0,10),n=0,o=N(T).height()-(N("#wpadminbar ").height()||0),s=function(e){var a;return!(e.hasClass("sicky-toolbar")||(a=e.find(".editor-toolbar:eq(0)"),e.height()-a.height()<o)||(n=1,e.addClass("sicky-toolbar"),a.addClass("mmd-sticky"),e.find(".editor-endbar").length||e.append(N('<div class="editor-endbar"></div>')),i.stickyInst.push(new T.Waypoint.Sticky({element:a[0]})),i.stickyInst.push(new T.Waypoint({element:e.children(".editor-endbar")[0],handler:function(e){"down"===e?N(this.element).parent().addClass("mmd-sticky-end"):"up"===e&&N(this.element).parent().removeClass("mmd-sticky-end")},offset:"bottom-in-view"})),0))},d=function(){return!(!i.stickyInst||!i.stickyInst.length||(n=0,i.stickyInst=i.stickyInst||[],i.stickyInst.length&&(T.Waypoint.destroyAll(),i.stickyInst=[]),N(".EasyMDEContainer ").each(function(){var e=N(this).removeClass("sicky-toolbar").removeClass("mmd-sticky-end");e.find(".editor-toolbar").removeClass("mmd-sticky").each(function(){N(this).removeAttr("style"),N(this).parent().hasClass("sticky-wrapper")&&e.prepend(this)}),e.find(".sticky-wrapper").remove()}),0))};r?(N(".EasyMDEContainer").each(function(){s(N(this))}),N(T).off("resize.mmd_win_sticky_toolbar").on("resize.mmd_win_sticky_toolbar",function(){N(".EasyMDEContainer").each(function(){N(this).find(".editor-toolbar.mmd-sticky").css({width:Math.ceil(N(this).width())-22})})}).trigger("resize.mmd_win_sticky_toolbar"),e=0,t=function(){e=e||setTimeout(function(){N(".editor-toolbar.fullscreen").length?d():n?T.Waypoint.refreshAll():setTimeout(function(){N(".EasyMDEContainer").each(function(){s(N(this))}),N(T).trigger("resize.mmd_win_sticky_toolbar")},50),e=0},450)},N(I.body).off("click.mmd_body_sticky_toolbar").on("click.mmd_body_sticky_toolbar",function(e){t(),a=N(e.target).closest(".EasyMDEContainer")}),N(I).off("keyup.mmd_doc_sticky_toolbar").on("keyup.mmd_doc_sticky_toolbar",function(e){t(),e.keyCode&&13===e.keyCode&&a&&a.length&&!a.hasClass("sicky-toolbar")&&setTimeout(function(){o=N(T).height()-(N("#wpadminbar ").height()||0),s(a),N(T).trigger("resize.mmd_win_sticky_toolbar")},1e3)})):(N(I).off("keyup.mmd_doc_sticky_toolbar"),N(I.body).off("click.mmd_body_sticky_toolbar"),N(T).off("resize.mmd_win_sticky_toolbar"),d())}})(window.jQuery,window,document);