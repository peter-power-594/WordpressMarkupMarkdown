/**
 * @preserve The Markup Markdown's Media Module
 * @desc A simple efficient bridge between the Wordpress Media Library and the EasyMDE's CodeMirror Instance
 * @author Pierre-Henri Lavigne <lavigne.pierrehenri@proton.me>
 * @version 1.0.27
 * @license GPL 3 - https://www.gnu.org/licenses/gpl-3.0.html#license-text
 */
(()=>{function e(e){var i=this,t=(e=e||{}).callbacks||{};return fallbacks={widget:function(){},multisel:function(){}},t.widget&&"function"==typeof t.widget||(t.widget=fallbacks.widget),t.multisel&&"function"==typeof t.multisel||(t.multisel=fallbacks.multisel),i.base_url=e.base_url||"",i.callbacks=t,{initialize:function(){i.initialize()},open:function(){i.instance&&i.instance.open()}}}e.prototype.initialize=function(){var e=this;/wp-admin/.test(document.body.className||"");if(e.instance=wp.media({frame:"post",type:"image",multiple:!0,title:"Media"}),!e.instance)return window.console&&window.console.log&&window.console.log("Markup Markdown: The WP Media Library is not properly loaded"),!1;e.instance.on("update",function(){e.addMediaFromWidget(e.instance.state(),e.callbacks.widget)}),e.instance.on("insert",function(){e.addMediaFromSel(e.instance.state(),e.callbacks.multisel)})},e.prototype.addMediaFromWidget=function(e,i){e=e||!1;if(!e)return!1;var t=e.get("library"),e=t&&t.props&&t.props.attributes||{};if(!e.type)return!1;switch(e.type||"image"){case"audio":case"video":return i(wp.media.playlist.shortcode(t).string());default:return i(wp.media.gallery.shortcode(t).string())}},e.prototype.addMediaFromSel=function(l,e){var n,a,r=this,i=!!l&&l.get("selection");return!(!i||!i.length)&&(n=1<i.length?1:0,a=[],i.map(function(e){var i=e.toJSON(),t=(l.display(e)||{}).toJSON();switch(t.multiple=n,i.type||"image"){case"audio":a.push(r.addMediaAudio(i,t));break;case"video":a.push(r.addMediaVideo(i,t));break;default:a.push(r.addMediaImage(i,t))}}),e(1<a.length?"- "+a.join("\n- "):a[0]))},e.prototype.addMediaImage=function(e,i){var t=e.alt||e.title,l=e.caption||"",n=e.url,a="";return"/"!==(n=(n=i.size&&e.sizes[i.size]?e.sizes[i.size].url:n).replace(this.base_url,"")).charAt(0)&&-1===n.indexOf("http")&&(n="/"+n),a="!["+t+(l&&l.length?" -- "+l.replace(/\r|\n/,""):"")+"]("+n+")",i.align&&i.align.length&&(a+="{.align"+i.align+"}"),i.link&&i.link.length&&"none"!==i.link&&(a="["+a+"]","custom"===i.link?i.linkUrl&&i.linkUrl.length&&(i.linkUrl=i.linkUrl.replace(this.base_url,""),"/"!==i.linkUrl.charAt(0)&&-1===i.linkUrl.indexOf("http")&&(i.linkUrl="/"+i.linkUrl),a+="("+i.linkUrl):a+="("+("file"===i.link?n:e.link),i.multiple&&0<i.multiple?a+=' "myset%d '+(e.title&&e.title.length&&/[\w]+[^\w]/.test(e.title)?e.title:"")+'")':a+=")"),a},e.prototype.addMediaAudio=function(e,i){var t="",l=e.url.replace(this.base_url,"");return"/"!==l.charAt(0)&&-1===l.indexOf("http")&&(l="/"+l),i.link&&i.link.length?("embed"===i.link?t='[audio src="'+l+'"][/audio]':(t="["+e.title+"](","file"===i.link?t+=l:t+=l="/"!==(l=(e.link||"").replace(this.base_url,"")).charAt(0)&&-1===l.indexOf("http")?"/"+l:l,t+=")"),t):""},e.prototype.addMediaVideo=function(e,i){var t="",l=e.url.replace(this.base_url,"");return"/"!==l.charAt(0)&&-1===l.indexOf("http")&&(l="/"+l),i.link&&i.link.length?("embed"===i.link?t='[video width="'+e.width+'" height="'+e.height+'" src="'+l+'"][/video]':(t="["+e.title+"](","file"===i.link?t+=l:t+=l="/"!==(l=(e.link||"").replace(this.base_url,"")).charAt(0)&&-1===l.indexOf("http")?"/"+l:l,t+=")"),t):""},window.MmdMedia=e})(window.jQuery);